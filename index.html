<!DOCTYPE html><html><head><title>bqn-tetris</title><meta charset="utf-8"/><link href="prism.css" rel="stylesheet"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<style>*{color:#fff;background-color:#000;text-align:left}pre{font-family:BQN386,monospace;margin:1em}
@font-face{font-family: BQN386;src:url(BQN386.subset.woff2) format('woff2');}
@media only screen and (min-width:500px){body{display:flex}}</style>
<script src="bqn.js"></script><script src="prism.js"></script><script>raf=requestAnimationFrame.bind(window);pd=e=>e.preventDefault();
flr=Math.floor;ael=addEventListener;fx=10;fy=20;go=(t,f)=>{for(let i=0;i<t;++i)f(i)};goa=(a,f)=>a.forEach(f);p=Prism;
de=document.documentElement;b=flr(Math.min((de.clientHeight-20)/fy,(de.clientWidth-20)/fx));onload=async()=>{
cx=c.getContext('2d');fs=s=>cx.fillStyle=s;fr=cx.fillRect.bind(cx);w=c.width=fx*b;h=c.height=fy*b;
col={0:'#333',1:'blue'};d=(f)=>{goa(f,(e,i)=>{fs(col[e]);fr(i*b%w,flr(i*b/w)*b,b-1,b-1)})};
t=await(await fetch("tetris.bqn")).text();g=run.apply(null,compile(t));src.innerHTML=p.highlight(t,p.languages.bqn,'bqn');
ns=nsget(g);kh=ns('kh');gs=ns('gamestate');st=ns('step');gm=ns('game');
dokh=(k,e)=>{if(e&&k.includes(1))pd(e);kh(list([-k[0],k[1]*-1+k[2],k[3]]))}
ael('keydown',e=>{kc=e.keyCode;k=[38,37,39,40].map(c=>c==kc?1:0);dokh(k,e)});
ael('touchstart',e=>{e=e.touches[0];x=e.clientX;y=e.clientY;u=y<=h/4;l=y>h/4*3;dokh([+u,+(!u&&!l&&x<w/2),+(!u&&!l&&x>=w/2),+l])})
spd=750;s=0;dost=ts=>{if(!s)s=ts;d(gs());if(ts-s>spd){st(gm);s=ts};raf(dost)};raf(dost);
}</script></head><body><canvas id="c"></canvas><pre id="src"/></body></html>
